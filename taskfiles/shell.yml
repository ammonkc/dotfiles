# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

vars:
  ZDOTDIR: '${ZDOTDIR:-$HOME/.config/zsh}'
  YAZI_CONFIG_DIR: '${XDG_CONFIG_HOME:-$HOME/.config}/yazi'

tasks:
  setup:
    desc: Run post-install setup for shell tools
    summary: |
      Runs setup tasks for various shell tools after dotfiles are stowed:
      - Installs yazi plugins and flavors from package.toml
      - Clears zsh caches
    cmds:
      - task: yazi:install
      - task: clear_cache

  yazi:install:
    desc: Install yazi plugins and flavors
    summary: |
      Installs yazi plugins and flavors defined in package.toml
      Requires 'ya' (yazi package manager) to be installed
    preconditions:
      - sh: command -v ya >/dev/null 2>&1
        msg: "'ya' command not found. Install yazi first."
      - sh: test -f "{{.YAZI_CONFIG_DIR}}/package.toml"
        msg: "package.toml not found. Run 'task dot:install' first."
    cmds:
      - echo "ðŸ“¦ Installing yazi plugins and flavors..."
      - ya pack -i
      - echo "âœ“ Yazi plugins installed"

  reload:
    desc: Reload shell configuration
    summary: |
      Reloads the current shell by executing a new instance
      This will pick up any changes to shell configuration

      Equivalent to: exec $SHELL
    cmds:
      - exec $SHELL

  source:
    desc: Source zsh configuration files
    summary: |
      Sources zsh configuration without starting a new shell
      Useful for testing config changes
    cmds:
      - source ~/.zshenv
      - source {{.ZDOTDIR}}/.zshrc

  clear_cache:
    desc: Clear zsh caches
    summary: |
      Clears zsh evaluation cache and completion cache
      Run this if you're experiencing shell slowness or stale completions
    cmds:
      - rm -rf ~/.cache/zsh/zsh-eval-cache/*
      - rm -f {{.ZDOTDIR}}/.zcompdump*

