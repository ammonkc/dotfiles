# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

includes:
  backup:
    taskfile: ./taskfiles/backup.yml

  brew:
    taskfile: ./taskfiles/brew.yml

  clean:
    taskfile: ./taskfiles/clean.yml

  develop:
    aliases: [dev]
    taskfile: ./taskfiles/develop.yml

  git:
    taskfile: ./taskfiles/git.yml

  info:
    taskfile: ./taskfiles/info.yml

  linux:
    taskfile: ./taskfiles/linux.yml

  dotfiles:
    aliases: [dot]
    taskfile: ./taskfiles/dotfiles.yml

  mac:
    taskfile: ./taskfiles/mac.yml

  mise:
    taskfile: ./taskfiles/mise.yml

  nvim:
    taskfile: ./taskfiles/nvim.yml

  shell:
    taskfile: ./taskfiles/shell.yml

  system:
    taskfile: ./taskfiles/system.yml

tasks:
  default:
    cmd: task -l
    silent: true

  install:
    desc: Complete system setup - installs dependencies, builds utilities, configures dotfiles, and sets up Neovim
    summary: |
      Performs a full system setup by:
      1. Installing all system dependencies (Homebrew and packages)
      2. Installing and configuring all dotfiles (stow packages)
      3. Installing mise-managed tools (after mise config is stowed)
      4. Restoring Neovim plugins to the state specified in lazy-lock.json

      Note: This does NOT apply macOS system preferences.
      Run 'task mac:set:defaults' separately if you want to apply them.
    cmds:
      - task: system:install
      - task: mise:install
      - task: nvim:restore

  doctor:
    desc: Run comprehensive health checks on your dotfiles setup
    summary: |
      Performs health checks for:
      - Dotfiles symlinks and integrity
      - Neovim configuration
      - mise runtime manager
      - System package manager (Linux only)

      Run this to diagnose issues with your environment
    cmds:
      - echo "üè• Running dotfiles health checks..."
      - echo ""
      - task: dot:doctor
      - echo ""
      - task: mise:doctor
      - echo ""
      - task: nvim:check
      - echo ""
      - task: linux:doctor
      - echo ""
      - echo "‚úì Health check complete"

  clean:
    desc: Clean up caches, old backups, and temporary files
    summary: |
      Comprehensive cleanup:
      - Shell caches (zsh)
      - Old backup files (keeps 5 most recent)
      - Package manager artifacts
      - Old log files (30+ days)
      - Reports on broken symlinks

      Safe to run regularly
    cmds:
      - task: clean:all

  info:
    desc: Show comprehensive dotfiles environment information
    summary: |
      Displays detailed information about:
      - System environment (OS, architecture, shell)
      - Dotfiles configuration
      - Installed tool versions
      - Package counts
      - Git repository status
    cmds:
      - task: info:all
