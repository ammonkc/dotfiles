# vim:ft=gitconfig
[core]
  quotepath = false
  excludesfile = ~/.config/git/ignore
  editor = /opt/homebrew/bin/nvim
  autocrlf = input
  pager = delta
[init]
	defaultBranch = main
[checkout]
  defaultRemote=origin
[pull]
	ff = only
[push]
  default = tracking
[merge]
	conflictStyle = zdiff3
[rebase]
  autosquash = true
	updateRefs = true
  instructionFormat = "[%an - %ar] %s"
  # autoStash = true
[rerere]
  enabled = true
[diff]
  colorMoved = zebra
  algorithm = histogram
[apply]
  # do not warn about missing whitespace at EOF
  whitespace = nowarn
[commit]
  gpgsign = true
	cleanup = scissors
  template = ~/.config/git/gitmessage
[transfer]
	fsckobjects = true
[fetch]
	fsckobjects = true
[receive]
	fsckObjects = true
[branch]
  autosetupmerge = true
  sort = -committerdate
[gpg]
  format = ssh
[gpg "ssh"]
  program = "/Applications/1Password.app/Contents/MacOS/op-ssh-sign"
[grep]
  extendRegexp = true
  lineNumber = true
# [url "git@github.com:"]
#   insteadOf = https://github.com/
[tag]
	sort = taggerdate
[credential]
  helper = osxkeychain
[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true
[interactive]
  diffFilter = delta --color-only

[delta]
  side-by-side = true
  line-numbers = true
  features = "tokyonight" unobtrusive-line-numbers decorations
  true-color = always
  whitespace-error-style = 22 reverse
  syntax-theme = base16-256

[delta "tokyonight"]
  # https://github.com/folke/tokyonight.nvim/blob/v3.0.1/extras/delta/tokyonight_night.gitconfig
  minus-style                   = syntax "#37222c"
  minus-non-emph-style          = syntax "#37222c"
  minus-emph-style              = syntax "#713137"
  minus-empty-line-marker-style = syntax "#37222c"
  line-numbers-minus-style      = "#b2555b"
  plus-style                    = syntax "#20303b"
  plus-non-emph-style           = syntax "#20303b"
  plus-emph-style               = syntax "#2c5a66"
  plus-empty-line-marker-style  = syntax "#20303b"
  line-numbers-plus-style       = "#266d6a"
  line-numbers-zero-style       = "#3b4261"
[delta "unobtrusive-line-numbers"]
    line-numbers = true
    # line-numbers-minus-style = "#444444"
    # line-numbers-zero-style = "#444444"
    # line-numbers-plus-style = "#444444"
    line-numbers-left-format = "{nm:>4}┊"
    line-numbers-right-format = "{np:>4}│"
    line-numbers-left-style = blue
    line-numbers-right-style = blue
[delta "decorations"]
    commit-decoration-style = bold yellow box ul
    file-style = bold yellow ul
    file-decoration-style = none
    hunk-header-decoration-style = yellow box

[help]
  autocorrect = prompt
[advice]
  pushNonFastForward = false
  statusHints = false
[log]
	date = iso

[feature]
  # https://www.git-tower.com/blog/git-performance/
  # https://git-scm.com/docs/git-config#Documentation/git-config.txt-featuremanyFiles
  #
  # Configures the following settings:
  #
  # index.skipHash=true
  # index.version=4
  # core.untrackedCache=true
  #
  manyFiles = true

[maintenance]
  # https://git-scm.com/docs/git-config#Documentation/git-config.txt-maintenanceauto
  auto = false
  # https://git-scm.com/docs/git-config#Documentation/git-config.txt-maintenancestrategy
  strategy = incremental

[color]
    diff = auto
    status = auto
    branch = auto
    interactive = auto
    ui = auto
[color "branch"]
    current = green bold
    local = green
    remote = red bold
[color "diff"]
    meta = yellow bold
    frag = magenta bold
    old = red bold
    new = green bold
[color "status"]
    added = green bold
    changed = yellow bold
    untracked = red
[color "sh"]
    branch = yellow

[alias]
    #Basic
    s = status --short --branch
    st = status
    co = checkout

    #Flow
    fs = flow feature start
    ff = flow feature finish
    rs = flow release start
    rf = flow release finish

    #Infoz
    count = shortlog -sn
    df = diff --word-diff
    ba = branch -a
    br = branch -v
    rv = remote -v
    sh = show --pretty=format: --name-only

    #Log
    last = log -1 HEAD
    lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit

    #commit
    amend = commit -a --amend
    cm = commit
    cmm = commit -m

    # push new branch - push a branch to origin and set upstream
    pnb = "!git push --set-upstream origin $(git rev-parse --abbrev-ref HEAD)"

    # force push - use force-with-lease to avoid overwriting other people's work
    fp = push --force-with-lease

    # rebase commands
    cont = rebase --continue
    continue = "!GIT_EDITOR=true git rebase --continue"
    conf = "!git s | grep ^U"
    # rebase the current branch with changes from upstream remote
    update = "!git fetch upstream && git rebase upstream/$(git rev-parse --abbrev-ref HEAD)"

    #Undo
    undo = "!git reset HEAD~ && git clean -df"
    undosoft = reset --soft HEAD~1

    # Undo a `git push`
    undopush = "!git push -f origin HEAD^:$(git symbolic-ref --short HEAD)"

    # show all deleted files in the repo
    deleted = "!git log --diff-filter=D --summary | grep delete"

    cleanup = "!git remote prune origin && git gc && git clean -df && git stash clear"
    # clean up all
    forget = "!git fetch -p origin && git branch -vv | awk '/: gone]/{print $1}' | xargs git branch -D"

    delete-merged-branches = "!f() { git checkout --quiet master && git branch --merged | grep --invert-match '\\*' | xargs -n 1 git branch --delete; git checkout --quiet @{-1}; }; f"
    # diff = diff --ignore-space-at-eol -b -w --ignore-blank-lines
    d = "!git diff --ignore-space-at-eol -b -w --ignore-blank-lines -- ':!**/package-lock.json' ':!**/yarn.lock'"

    latest = "!git for-each-ref --sort='-committerdate' --format='%(color:red)%(refname)%(color:reset)%09%(committerdate)' refs/remotes | sed -e 's-refs/remotes/origin/--' | less -XFR"

    # submodule shortcuts
    si = submodule init
    su = submodule update
    sub = "!git submodule sync && git submodule update"

    # list all aliases
    la = "!git config -l | grep alias | cut -c 7-"

    # gh commands
    browse = "!gh repo view --web"

    day = "!sh -c 'git log --reverse --no-merges --branches=* --date=local --after=\"yesterday 11:59PM\" --author=\"`git config --get user.name`\"'"

    # show the committers in the last 100 commits, sorted by who has commited the most
    review = "!git log --no-merges --pretty=%an | head -n 100 | sort | uniq -c | sort -nr"

    # grep commands

    # 'diff grep'
    dg = "!sh -c 'git ls-files -m | grep $1 | xargs git diff' -"
    # diff grep changes between two commits
    dgc = "!sh -c 'git ls-files | grep $1 | xargs git diff $2 $3 -- ' -"
    # 'checkout grep'
    cg = "!sh -c 'git ls-files -m | grep $1 | xargs git checkout ' -"
    # add grep
    ag = "!sh -c 'git ls-files -m -o --exclude-standard | grep $1 | xargs git add --all' -"
    # add all
    aa = "!git ls-files -d | xargs git rm && git ls-files -m -o --exclude-standard | xargs git add"
    # remove grep - Remove found files that are NOT under version control
    rg = "!sh -c 'git ls-files --others --exclude-standard | grep $1 | xargs rm' -"

[include]
  path = "~/.gitconfig.local"
